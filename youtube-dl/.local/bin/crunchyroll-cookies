#!/usr/bin/env python3

from glob import glob
from pathlib import Path

import http.cookiejar
import sqlite3

def get_cookies(cj, ff_cookies):
    con = sqlite3.connect(ff_cookies)
    cur = con.cursor()
    cur.execute(
        "SELECT host, path, isSecure, expiry, name, value FROM moz_cookies WHERE baseDomain=?",
        ('crunchyroll.com',)
    )
    for item in cur.fetchall():
        c = http.cookiejar.Cookie(
            0, item[4], item[5],
            None, False,
            item[0], item[0].startswith('.'), item[0].startswith('.'),
            item[1], False,
            item[2],
            item[3], item[3]=="",
            None, None, {}
        )
        print(c)
        cj.set_cookie(c)

ff_cookies = next(Path("~/.mozilla/firefox").expanduser().glob("*/cookies.sqlite"))

cj = http.cookiejar.MozillaCookieJar()
get_cookies(cj, ff_cookies)
cj.save(Path("~/.crunchyroll-cookies.txt").expanduser())
