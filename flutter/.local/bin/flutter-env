#!/bin/sh

trap "rm -f shell.nix" EXIT

cat << EOF > shell.nix
{ pkgs ? import <nixpkgs> {config.android_sdk.accept_license = true;} }:

let
  flutterPkgs  = (import (builtins.fetchTarball "https://github.com/babariviere/nixpkgs/archive/flutter-testing.tar.gz") {});
  unstablePkgs = (import (builtins.fetchTarball "https://github.com/NixOS/nixpkgs/archive/nixpkgs-unstable.tar.gz") {});
in
pkgs.mkShell {
  buildInputs = with pkgs; [
    flutterPkgs.flutter
    unstablePkgs.android-studio
    jdk
    git
  ];

  shellHook=''
    export USE_CCACHE=1
    export ANDROID_JAVA_HOME=\${pkgs.jdk.home}
    export ANDROID_HOME=~/.androidsdk
    export FLUTTER_SDK=\${flutterPkgs.flutter.unwrapped}
  '';
}
EOF

nix-shell
